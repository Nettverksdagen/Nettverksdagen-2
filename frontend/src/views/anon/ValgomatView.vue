<template>
  <div>
    <!-- Render the quiz questions and results here -->
    <QuestionCard
      v-if="questions.length && !showResults"
      :question="questions[currentQuestionIndex]"
      @answerSelected="handleAnswer"
    />
    <div v-if="showResults">
      <h1>Results</h1>
      <p>Based on your answers, here are the top companies that match your preferences:</p>
      <ul>
        <li v-for="company in topCompanies" :key="company">{{ company }}</li>
      </ul>
    </div>
    <ProgressBar :progress="progress" />
    <div v-if="!showResults" class="navigation-buttons">
      <b-button @click="prevQuestion" :disabled="currentQuestionIndex === 0">Previous</b-button>
    </div>
  </div>
</template>
  
<script>
import QuestionCard from '@/components/valgomat/QuestionCard.vue'
import ProgressBar from '@/components/valgomat/ProgressBar.vue'

export default {
  components: {
    QuestionCard,
    ProgressBar
  },
  data() {
    return {
      showResults: false,
      progress: 0,
      currentQuestionIndex: 0,
      topCompanies: [], // Stores top 3 companies based on the user's answers
      questions: [
        {
          id: 1,
          text: "What type of work environment do you prefer?",
          options: [
            { id: 1, text: "Collaborative", companyWeights: { CompanyA: 1, CompanyB: 2, CompanyC: 3 } },
            { id: 2, text: "Independent", companyWeights: { CompanyA: 3, CompanyB: 2, CompanyC: 1 } },
          ],
        },
        {
          id: 2,
          text: "What is your preferred programming language?",
          options: [
            { id: 1, text: "JavaScript", companyWeights: { CompanyA: 1, CompanyB: 2, CompanyC: 3 } },
            { id: 2, text: "Python", companyWeights: { CompanyA: 3, CompanyB: 2, CompanyC: 1 } },
          ],
        },
        {
          id: 3,
          text: "What is your preferred development methodology?",
          options: [
            { id: 1, text: "Agile", companyWeights: { CompanyA: 1, CompanyB: 2, CompanyC: 3 } },
            { id: 2, text: "Waterfall", companyWeights: { CompanyA: 3, CompanyB: 2, CompanyC: 1 } },
          ],
        },
      ],
      selectedAnswers: {}, // Stores the user's selected answers by question ID
    };
  },
  methods: {
    handleAnswer(questionId, option) {
      this.selectedAnswers[questionId] = option;
      this.calculateProgress();
      this.nextQuestion();
    },
    nextQuestion() {
      
      if (this.currentQuestionIndex < this.questions.length - 1) {
        this.currentQuestionIndex++;
        this.calculateProgress();
      } else {
        this.currentQuestionIndex++;
        this.calculateScores();
        this.showResults = true;
      }
    },
    prevQuestion() {
      if (this.currentQuestionIndex > 0) {
        this.currentQuestionIndex--;
        this.calculateProgress();
      }
    },
    calculateScores() {
      const companyScores = {};
      for (const question of this.questions) {
        const answer = this.selectedAnswers[question.id];
        if (answer) {
          for (const [company, score] of Object.entries(answer.companyWeights)) {
            companyScores[company] = (companyScores[company] || 0) + score;
          }
        }
      }
      this.topCompanies = Object.entries(companyScores)
      .sort(([, scoreA], [, scoreB]) => scoreB - scoreA)
      .slice(0, Math.min(3, Object.keys(companyScores).length))
      .map(([company]) => company);
    },
    calculateProgress() {
      this.progress = this.currentQuestionIndex / this.questions.length * 100;
      //this.progress = (Object.keys(this.selectedAnswers).length / this.questions.length) * 100;
    }
  },
};
</script>

<style lang="scss" scoped>
  .introduction {
    font-size:18px;
    text-align: center;
    @media(min-width: 768px) {
      text-align: left;
      margin-right: 30px;
    }
  }
  h1 {
    font-size: 36px;
    font-weight: 600;
    text-align: center;
    color: black;
    margin-bottom: 30px;
    margin-top: 40px;
  }
  .navigation-buttons {
    display: flex;
    justify-content: space-between;
    margin-top: 20px;
  }
</style>
